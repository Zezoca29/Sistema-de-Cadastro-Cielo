<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="Cielo logo.png">
    <title>Painel de Usuários</title>
    <link rel="stylesheet" href="home.css">
</head>

<body>
    <div class="container">
        <img src="Cielo logo.png" alt="">
        <h1 class="titulo">Painel de Usuários</h1>
        <a class="back-arrow" onclick="window.history.back()">&#8592; Voltar</a>
    </div>
    <div class="grid-container" id="usuarios"></div>

    <div class="overlay" id="overlay">
        <div class="overlay-content" id="overlay-content"></div>
    </div>
    <script src="login.js"></script>
    <script>
        // Função para abrir o card sobreposto com as informações completas do usuário
        function openUserCard(nome, email, senha, dataNascimento) {
            const overlay = document.getElementById('overlay');
            const overlayContent = document.getElementById('overlay-content');

            overlayContent.innerHTML = `
                <p><strong>Nome:</strong> ${nome}</p>
                <p><strong>Email:</strong> ${email}</p>
                <p><strong>Senha:</strong> ${senha}</p>
                <p><strong>Data de Nascimento:</strong> ${dataNascimento}</p>
                <button class="btn" onclick="editUser('${nome}', '${email}', '${senha}', '${dataNascimento}')">Editar</button>
                <button class="btn2" onclick="deleteUser('${email}')">Excluir</button>
                <button class="close-btn" onclick="closeOverlay()">Fechar</button>
            `;

            overlay.style.display = 'flex';
        }

        // Função para editar um usuário
        function editUser(nome, email, senha, dataNascimento) {
            const novoNome = prompt('Digite o novo nome:', nome);
            const novaSenha = prompt('Digite a nova senha:', senha);
            const novaDataNascimento = prompt('Digite a nova data de nascimento:', dataNascimento);

            fetch(`/usuarios/${email}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    nome: novoNome,
                    senha: novaSenha,
                    dataNascimento: novaDataNascimento
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Usuário atualizado:', data);
                    location.reload();
                })
                .catch(error => console.error('Erro ao atualizar usuário:', error));
        }

        // Função para excluir um usuário
        function deleteUser(email) {
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                fetch(`/usuarios/${email}`, {
                    method: 'DELETE'
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Usuário excluído:', data);
                        location.reload();
                    })
                    .catch(error => console.error('Erro ao excluir usuário:', error));
            }
        }

        // Função para fechar o overlay
        function closeOverlay() {
            const overlay = document.getElementById('overlay');
            overlay.style.display = 'none';
        }

        fetch('/usuarios')
            .then(response => response.json())
            .then(data => {
                const usuariosDiv = document.getElementById('usuarios');
                data.forEach(usuario => {
                    const usuarioDiv = document.createElement('div');
                    usuarioDiv.classList.add('card');
                    usuarioDiv.innerHTML = `
                        <p><strong>Nome:</strong> ${usuario.nome}</p>
                        <p><strong>Email:</strong> ${usuario.email}</p>
                    `;
                    usuarioDiv.addEventListener('click', () => {
                        openUserCard(usuario.nome, usuario.email, usuario.senha, usuario.dataNascimento);
                    });
                    usuariosDiv.appendChild(usuarioDiv);
                });
            })
            .catch(error => console.error('Erro ao buscar usuários:', error));
    </script>
</body>

</html>